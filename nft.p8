pico-8 cartridge // http://www.pico-8.com
version 42
__lua__

offsetx=32
offsety=32
mapw=8
maph=8
hidden = {}

aniitvl=0.25

function resetmap()
 for col=0,mapw-1 do
  hidden[col] = {}
  for row =0,maph-1 do
   hidden[col][row] = true
  end
 end
end

function _init()
 y=6
 x=1
 fedges = 0
 resetmap()
end

function update_edges()
 fedges = 0
 --horizontal edges
 for col=0,mapw-1 do
  for row=0,maph-2 do
   f1 = not hidden[col][row]
   f2 = not hidden[col][row+1]
   diff = mget(col,row) != mget(col,row+1)
   if f1 and f2 and diff do
    fedges += 1
   end
  end
 end
 
 --vertical edges
 for col=0,mapw-2 do
  for row=0,maph-1 do
   f1 = not hidden[col][row]
   f2 = not hidden[col+1][row]
   diff = mget(col,row) != mget(col+1,row)
   if f1 and f2 and diff do
    fedges += 1
   end   
  end
 end
  
 return fedges
end

function unhide(x, y)
 hidden[x][y] = false
 fedges = update_edges()
end

function _update()
 if btnp(â¬…ï¸) then x=(x-1)%mapw end
 if btnp(âž¡ï¸) then x=(x+1)%mapw end
 if btnp(â¬†ï¸) then y=(y-1)%maph end
 if btnp(â¬‡ï¸) then y=(y+1)%maph end
 if btnp(âŽ) then unhide(x, y) end
 if btnp(ðŸ…¾ï¸) then resetmap() end

end

function drawcurse()
 spr(4, offsetx+x*8, offsety+y*8)
end

function drawmap()
 for col=0,mapw-1 do
  for row =0,maph-1 do
   if hidden[col][row] do
    treespr=3
   else
    treespr=mget(col, row)
   end
   --flip the trees every few frames
   flipx = (time() / aniitvl) % 2 > 1
   spr(treespr, offsetx+col*8, offsety+row*8, 1, 1, flipx)
  end
 end
end

function _draw()
 cls()
 drawmap()
 -- map(0, 0, offsetx, offsety, mapw, maph)
 drawcurse()
 print(fedges,16, 16)
end
__gfx__
0000000000033000000a8000000dd000220000220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000003300000089000000dd000200000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700003333000089a80000dddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000333300009a890000dddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000333333009a89a800dddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000440000004400000055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000440000004400000055000200000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000220000220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020202010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020202020101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020202020101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020202010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
